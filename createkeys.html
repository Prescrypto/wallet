<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sequentia Wallet</title>
  <link rel="stylesheet" type="text/css" href="css/sequentiawallet.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/css/uikit.min.css" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,900" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/js/uikit.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/js/uikit-icons.min.js"></script>
</head>
<body>
  <!-- Main menu -->
  <nav class="uk-navbar-container" uk-navbar="boundary-align: true; align: right;">
    <div class="uk-navbar-left">
      <ul class="uk-navbar-nav">
        <li><a class="uk-navbar-item uk-logo" href="index.html"> SequentiaWallet </a></li>
      </ul>
    </div>
    <div class="uk-navbar-right">
      <ul class="uk-navbar-nav">
        <li>
          <a class="uk-navbar-toggle" uk-navbar-toggle-icon href=""></a>
          <div class="uk-navbar-dropdown">
            <ul class="uk-nav uk-navbar-dropdown-nav">
              <li id="menu_item"><a href="https://genobank.herokuapp.com/">Go to Navigator</a></li>
              <li id="menu_item">
                <form class="uk-search uk-search-default">
                  <span class="uk-search-icon-flip" uk-search-icon></span>
                  <input class="uk-search-input" type="search" placeholder="Search...">
                </form>
              </li>
              <li id="menu_item"><a href="#">Contact</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </nav>
  <!-- Closing Main menu -->

<div class="uk-grid-medium" align="center">
  <form class="uk-form-horizontal uk-margin-large">
    <div class="uk-margin">
      <label class="uk-form-label" for="form-horizontal-text">Private Key</label>
        <div class="uk-form-controls">
          <textarea id="privkey" name="privkey" class="uk-input" type="text" placeholder="Generate keys"></textarea>
        </div>       
    </div>
    <div class="uk-margin">
      <label class="uk-form-label" for="form-horizontal-text">Public Key</label>
        <div class="uk-form-controls">
          <textarea id="pubkey" name="pubkey" class="uk-input" type="text" placeholder="Generate keys"></textarea>
        </div>       
    </div>
    <div class="uk-margin">
      <label class="uk-form-label" for="form-horizontal-text">Pin Code</label>
        <div class="uk-form-controls">
          <input id="pin_code" name="pin_code" class="uk-input" type="text" maxlength="4" placeholder="Enter four digits and remember not to forget this PIN" required />
          <button style="font-size:12px;" class="uk-margin-small uk-button uk-button-primary uk-button-small" id="download_keys">Save Keys</button>
        </div>
        
    </div>
   <a id="whitebutton" class="uk-button uk-button-default" href="genometrics.html"> Next </a>
  </form>
</div>

<script src="js/localforage.min.js"></script>
<script src="https://code.jquery.com/jquery-1.8.3.min.js"></script>
<script src="js/jsencrypt.js"></script>
<script src="js/wallet.js"></script>
<script>
    $(document).ready(function() {
      (function ($, localforage){
          function setKeys(){
          // Get the keys from localforage
          localforage.getItem('privatekey', function(err, value){
            $('#privkey').val(value);
          });
          localforage.getItem('publickey', function(err, value){
            $('#pubkey').val(value);
          });
        };
        setKeys();
      })($, localforage);
    });
    //Events
    //Download keys files
    $('#download_keys').click(function(){
      //Read keys
      var privatekey = $('#privkey').val();
      var publickey = $('#pubkey').val();
      
      //Make a list for create the download link  
      var files = [privatekey, publickey]
      var names_files = ["Pivate_Key.pem", "Public_Key.pem"]

      for (var i=0; i<files.length; i++){
        //Create a label type a
        var link = document.createElement("a");
        // Add attributes to label type a
        link.download = names_files[i]
        link.href = 'data:application/octet-stream,'+ encodeURIComponent(files[i]);
        link.click();
      }
    });
    $(function(){
    //Validation for Pin code
    $('#pin_code').keypress(function(e) {
      if(isNaN(this.value + String.fromCharCode(e.charCode))) 
        return false;
      })
    });

</script>
</body>
</html>
